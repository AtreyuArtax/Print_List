<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Print a List (Quadrant layout)</title>
<style>
  :root{
    --fg:#111; --bg:#fafafa; --muted:#666;
    --section-gap: 1.0rem; --line-gap: .32rem;
    --title-size: 1.55rem; --heading-size: 1.05rem; --item-size: 1rem;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:900px;margin:auto;padding:16px 14px 40px}
  h1{font-size:var(--title-size);margin:0 0 12px;line-height:1.2}
  .hint{color:var(--muted);font-size:.9rem;margin-bottom:8px}
  textarea{width:100%;min-height:240px;resize:vertical;font:14px/1.4 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;padding:12px;border:1px solid #ddd;border-radius:8px;background:#fff;color:#000}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
  button{cursor:pointer;border:1px solid #111;background:#111;color:#fff;padding:10px 14px;border-radius:8px;font-weight:600}
  button.secondary{background:#fff;color:#111}
  .out{margin-top:16px;padding:12px;border:1px dashed #ccc;border-radius:10px;background:#fff;position:relative}
  .list-title{font-size:1.3rem;font-weight:800;margin:0 0 8px}
  .section{break-inside: avoid;margin-top:var(--section-gap)}
  .section h2{font-size:var(--heading-size);margin:0 0 6px;border-bottom:1px solid #e7e7e7;padding-bottom:4px}
  ul.items{list-style:none;margin:0;padding:0;display:grid;gap:var(--line-gap)}
  li.item{display:flex;align-items:center;gap:.55rem;font-size:var(--item-size)}
  .cb{width:1.05rem;height:1.05rem;flex:0 0 auto;border:1.8px solid #111;border-radius:4px;display:inline-block}
  .item-label{flex:1}
  .empty-note{color:var(--muted);font-style:italic;margin:.4rem 0 .2rem}

  /* QUADRANT layout container */
  .grid4{display:grid;grid-template-columns:1fr 1fr;grid-auto-rows:auto;gap:16px}
  .quad{break-inside:avoid}
  .quad-title{font-weight:700;font-size:.95rem;margin:0 0 6px;color:#000}

  /* Fold guides (print only) */
  .fold-guides{display:none}
  @media print{
    :root{--title-size:1.8rem;--heading-size:1.12rem;--item-size:1.03rem}
    body{background:#fff}
    h1,.hint,textarea,.controls{display:none !important}
    .out{border:0;padding:0;background:transparent}
    .grid4{grid-template-columns:1fr 1fr;gap:18px}
    .fold-guides{display:block;position:fixed;inset:0;pointer-events:none}
    .fold-guides::before, .fold-guides::after{content:"";position:absolute;background:#000;opacity:.12}
    /* vertical midline */
    .fold-guides::before{top:0;bottom:0;width:1px;left:50%}
    /* horizontal midline */
    .fold-guides::after{left:0;right:0;height:1px;top:50%}
    @page{size:letter;margin:14mm}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Print a List</h1>
  <div class="hint">Paste your list (supports GitHub <code>- [ ]</code>/<code>- [x]</code> and your <code>‚úì</code>/<code>‚ó¶</code> style). It updates automatically below.</div>
  <textarea id="src" placeholder="Paste your markdown grocery list here..."></textarea>
  <div class="controls">
    <button class="secondary" id="btn-sample">Load Sample</button>
    <button class="secondary" id="btn-print" title="Open print dialog">Print</button>
  </div>

  <div id="out" class="out" aria-live="polite"></div>
  <div class="fold-guides" aria-hidden="true"></div>
</div>

<script>
// --- Parsing (same rules as your working copy) ---
const re = {
  atx: /^\s*(#{1,6})\s+(.*)\s*$/,
  mdUnchecked: /^\s*[-*+]\s*\[\s\]\s+(.*)$/,
  mdChecked:   /^\s*[-*+]\s*\[[xX]\]\s+(.*)$/,
  yourChecked: /^\s*‚úì\s+(.*)$/,
  yourUnchecked:/^\s*‚ó¶\s+(.*)$/,
  fallbackBullet:/^\s*[-*+]\s+(.*)$/
};
function parseMarkdownList(src){
  const lines = src.split(/\r?\n/);
  let title=null; const sections=[]; let currentSection=null;
  function ensureSection(name){ currentSection={name:name.trim(),items:[]}; sections.push(currentSection); }
  for(const raw of lines){
    const line = raw.replace(/\s+$/,''); if(!line.trim()) continue;
    const mAtx = line.match(re.atx);
    if(mAtx){ const level=mAtx[1].length; const text=mAtx[2].trim(); if(level===1 && !title){title=text;} else {ensureSection(text);} continue; }
    let isItem=false, checked=false, text=""; let m;
    if((m=line.match(re.mdChecked))){ isItem=true; checked=true;  text=m[1]; }
    else if((m=line.match(re.mdUnchecked))){ isItem=true; checked=false; text=m[1]; }
    else if((m=line.match(re.yourChecked))){ isItem=true; checked=true;  text=m[1]; }
    else if((m=line.match(re.yourUnchecked))){ isItem=true; checked=false; text=m[1]; }
    else if((m=line.match(re.fallbackBullet))){ isItem=true; checked=false; text=m[1]; }
    if(isItem){ if(!currentSection) ensureSection('Items'); if(!checked) currentSection.items.push(text.trim()); continue; }
    if(!title){ title=line.trim(); } else { ensureSection(line.trim()); }
  }
  return { title: title||'List', sections: sections.filter(s=>s.items.length>0) };
}

// --- Quadrant packing ---
function splitIntoQuadrants(sections){
  // weight = heading(1) + number of items
  const weights = sections.map(s=> 1 + s.items.length);
  const total = weights.reduce((a,b)=>a+b,0);
  const target = Math.max(1, Math.round(total/4));
  const quads = [[],[],[],[]];
  let qi=0, acc=0;
  for(let i=0;i<sections.length;i++){
    const w = weights[i];
    quads[qi].push(sections[i]);
    acc += w;
    if(qi<3 && acc>=target){ qi++; acc=0; }
  }
  return quads;
}

function renderQuadrants(model){
  const out = document.getElementById('out'); out.innerHTML = '';
  const title = document.createElement('div'); title.className='list-title'; title.textContent = model.title; out.appendChild(title);
  if(model.sections.length===0){ const p=document.createElement('div'); p.className='empty-note'; p.textContent='All items are checked. Nothing left to buy üéâ'; out.appendChild(p); return; }

  const grid = document.createElement('div'); grid.className='grid4'; out.appendChild(grid);
  const quads = splitIntoQuadrants(model.sections);
  for(let q=0;q<4;q++){
    const box = document.createElement('div'); box.className='quad'; grid.appendChild(box);
    for(const section of quads[q]){
      const sec = document.createElement('section'); sec.className='section';
      const h = document.createElement('h2'); h.textContent = section.name; sec.appendChild(h);
      const ul = document.createElement('ul'); ul.className='items';
      for(const item of section.items){
        const li=document.createElement('li'); li.className='item';
        const cb=document.createElement('span'); cb.className='cb'; cb.setAttribute('aria-hidden','true');
        const label=document.createElement('span'); label.className='item-label'; label.textContent=item;
        li.appendChild(cb); li.appendChild(label); ul.appendChild(li);
      }
      sec.appendChild(ul); box.appendChild(sec);
    }
  }
}

function filterNow(){
  const src = document.getElementById('src').value || '';
  const model = parseMarkdownList(src);
  renderQuadrants(model);
}

// UI
document.getElementById('btn-print').addEventListener('click', ()=>window.print());
document.getElementById('btn-sample').addEventListener('click', ()=>{
  const sample=`Costco List
Snacks
	‚úì	Granola bars
	‚úì	Made Good bars
	‚ó¶	Heavenly hunk
	‚ó¶	Fruit snacks

Baby
	‚úì	Diaper wipes
	‚úì	Pull ups

Grocery
	‚ó¶	Parmesan cheese 
	‚ó¶	Pasta sauce 
	‚ó¶	Butter chicken sauce
	‚ó¶	Peanut butter
	‚ó¶	Almond simple mills crackers
	‚ó¶	Tuna 
	‚ó¶	Kirkland almond nut butter
	‚úì	Coffee
	‚úì	Honey

Side fridges
	‚ó¶	Greek yogurt 

Freezer
	‚ó¶	Chicken strips

Produce 
	‚ó¶	Mushrooms
	‚ó¶	Peppers CHECK DATE
	‚ó¶	Bananas

Dips fridge
	‚ó¶	Hummus (2 pack)

Back Dairy Fridge
	‚úì	Eggs (30 tray)

Meat fridge
	‚ó¶	Feta cheese

Bakery
	‚ó¶	Tortillas keto
	‚ó¶	bread

Other
	‚ó¶	Charmin toilet paper
	‚ó¶	Plastic wrap

# Example of pure Markdown checklist
## Extra
- [ ] Salsa
- [x] Crackers
- [ ] Yogurt drinks`;
  document.getElementById('src').value=sample; filterNow();
});

// Auto-render while typing/pasting (debounced)
// FIX: removed stray extra "});" after this listener that caused "expected expression, got '}'"
let _tid;
document.getElementById('src').addEventListener('input', ()=>{
  clearTimeout(_tid);
  _tid = setTimeout(filterNow, 200);
});

// Hash support (&text=... &autoprint=1)
(function initFromHash(){
  const rawHash = location.hash.startsWith('#')?location.hash.slice(1):location.hash;
  if(!rawHash){ filterNow(); return; }
  const params = new URLSearchParams(rawHash);
  const t = params.get('text'); const auto = params.get('autoprint');
  if(t){
    let decoded=''; try{decoded=decodeURIComponent(t);}catch{ try{decoded=atob(t);}catch{decoded=t;} }
    document.getElementById('src').value=decoded; filterNow();
    if(auto==='1' || (auto && auto.toLowerCase()==='true')) setTimeout(()=>window.print(),300);
  } else {
    filterNow();
  }
})();

// --- Lightweight console tests ---
(function runTests(){
  function assert(name, cond){ if(!cond){ console.error('‚ùå', name); window.__testsFailed = true; } else { console.log('‚úÖ', name); } }
  // T1: Pure Markdown checkboxes
  const m1 = parseMarkdownList('# Title\n## S\n- [ ] Milk\n- [x] Eggs');
  assert('T1 title', m1.title==='Title');
  assert('T1 sections len', m1.sections.length===1);
  assert('T1 items filtered', m1.sections[0].items.length===1 && m1.sections[0].items[0]==='Milk');
  // T2: Custom ‚úì/‚ó¶ style
  const m2 = parseMarkdownList('List\nSect\n\t‚úì\tA\n\t‚ó¶\tB');
  assert('T2 title fallback', m2.title==='List');
  assert('T2 keeps only unchecked', m2.sections[0].items.length===1 && m2.sections[0].items[0]==='B');
  // T3: Fallback bullets treated as unchecked
  const m3 = parseMarkdownList('X\nY\n- Banana');
  assert('T3 one item', m3.sections[0].items[0]==='Banana');
  // T4: Items before any section go to "Items"
  const m4 = parseMarkdownList('My List\n- [ ] One\n- [ ] Two');
  assert('T4 default section name', m4.sections[0].name==='Items');
  // T5: Quadrant pack preserves total sections
  const testSecs = [
    {name:'A',items:['1','2']}, {name:'B',items:['1']}, {name:'C',items:['1','2','3']}, {name:'D',items:[]}, {name:'E',items:['1']}
  ];
  const quads = splitIntoQuadrants(testSecs);
  assert('T5 4 quadrants', quads.length===4);
  const countSecs = quads.reduce((n,q)=>n+q.length,0);
  assert('T5 preserves all sections', countSecs===testSecs.length);
  // T6: Deeper ATX heading becomes a section; checked item removed
  const m6 = parseMarkdownList('# Big\n### Tiny\n- [x] Gone\n- [ ] Stay');
  assert('T6 has Tiny section', m6.sections[0].name==='Tiny');
  assert('T6 only Stay remains', m6.sections[0].items.length===1 && m6.sections[0].items[0]==='Stay');

  if(window.__testsFailed){ console.warn('Some tests failed. Functionality may be affected.'); }
})();
</script>
</body>
</html>
